<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    
    <title>分布式下文件上传 | 一止长渊的博客</title>

    <meta name="description" content="&lt;p&gt;&lt;img src=&#34;https://cdn.nlark.com/yuque/0/2021/png/2648023/1616770699701-f9790556-8ff5-431d-bf42-0727c09fd9c7.png#align=left&amp;display=inline&amp;height=305&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=828&amp;originWidth=1730&amp;size=216539&amp;status=done&amp;style=none&amp;width=637&#34; alt=&#34;image.png&#34;&gt;&lt;br&gt;在微服务分布式情况下，不同于以前的单体项目校园中铺项目，是将用户上传的图片放置在单体项目所在服务器的某个文件夹下，单体应用也在这个文件夹，然后单体应用就可以直接访问。但是在分布式情况下，一个服务可能有很多实例部署在多台服务器上，如果仍然使用向单体项目一样的图片存储，则会导致该服务的其他实例的服务器上没有该用户上传的图片，所以为了解决这个问题，分布式中通过使用将用户的图片同一放置在一个位置，然后每个服务都来访问这个位置来存取图片就可以了，这里使用阿里云的对象存储 OSS。&lt;/p&gt;">
    <meta name="keywords" content="JAVA 后端 Spring">

    

    <meta property="og:locale" content="en" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content= "分布式下文件上传 | 一止长渊的博客"  />
    <meta property="og:description" content= "&lt;p&gt;&lt;img src=&#34;https://cdn.nlark.com/yuque/0/2021/png/2648023/1616770699701-f9790556-8ff5-431d-bf42-0727c09fd9c7.png#align=left&amp;display=inline&amp;height=305&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=828&amp;originWidth=1730&amp;size=216539&amp;status=done&amp;style=none&amp;width=637&#34; alt=&#34;image.png&#34;&gt;&lt;br&gt;在微服务分布式情况下，不同于以前的单体项目校园中铺项目，是将用户上传的图片放置在单体项目所在服务器的某个文件夹下，单体应用也在这个文件夹，然后单体应用就可以直接访问。但是在分布式情况下，一个服务可能有很多实例部署在多台服务器上，如果仍然使用向单体项目一样的图片存储，则会导致该服务的其他实例的服务器上没有该用户上传的图片，所以为了解决这个问题，分布式中通过使用将用户的图片同一放置在一个位置，然后每个服务都来访问这个位置来存取图片就可以了，这里使用阿里云的对象存储 OSS。&lt;/p&gt;" />
    <meta property="og:url" content="https://yizhichangyuan.github.io/2021/uncategorized/yuque/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/index.html" />
    <meta property="og:site_name" content="" />
    <meta property="article:author" content="一止长渊" />
    <meta property="article:publisher" content="" />
    <meta property="og:description" content="&lt;p&gt;&lt;img src=&#34;https://cdn.nlark.com/yuque/0/2021/png/2648023/1616770699701-f9790556-8ff5-431d-bf42-0727c09fd9c7.png#align=left&amp;display=inline&amp;height=305&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=828&amp;originWidth=1730&amp;size=216539&amp;status=done&amp;style=none&amp;width=637&#34; alt=&#34;image.png&#34;&gt;&lt;br&gt;在微服务分布式情况下，不同于以前的单体项目校园中铺项目，是将用户上传的图片放置在单体项目所在服务器的某个文件夹下，单体应用也在这个文件夹，然后单体应用就可以直接访问。但是在分布式情况下，一个服务可能有很多实例部署在多台服务器上，如果仍然使用向单体项目一样的图片存储，则会导致该服务的其他实例的服务器上没有该用户上传的图片，所以为了解决这个问题，分布式中通过使用将用户的图片同一放置在一个位置，然后每个服务都来访问这个位置来存取图片就可以了，这里使用阿里云的对象存储 OSS。&lt;/p&gt;" />
    <meta name="twitter:title" content="分布式下文件上传 | 一止长渊的博客"/>
    <meta name="twitter:description" content="&lt;p&gt;&lt;img src=&#34;https://cdn.nlark.com/yuque/0/2021/png/2648023/1616770699701-f9790556-8ff5-431d-bf42-0727c09fd9c7.png#align=left&amp;display=inline&amp;height=305&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=828&amp;originWidth=1730&amp;size=216539&amp;status=done&amp;style=none&amp;width=637&#34; alt=&#34;image.png&#34;&gt;&lt;br&gt;在微服务分布式情况下，不同于以前的单体项目校园中铺项目，是将用户上传的图片放置在单体项目所在服务器的某个文件夹下，单体应用也在这个文件夹，然后单体应用就可以直接访问。但是在分布式情况下，一个服务可能有很多实例部署在多台服务器上，如果仍然使用向单体项目一样的图片存储，则会导致该服务的其他实例的服务器上没有该用户上传的图片，所以为了解决这个问题，分布式中通过使用将用户的图片同一放置在一个位置，然后每个服务都来访问这个位置来存取图片就可以了，这里使用阿里云的对象存储 OSS。&lt;/p&gt;"/>
    <script type="application/ld+json">
        {
            "description": "&lt;p&gt;&lt;img src=&#34;https://cdn.nlark.com/yuque/0/2021/png/2648023/1616770699701-f9790556-8ff5-431d-bf42-0727c09fd9c7.png#align=left&amp;display=inline&amp;height=305&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=828&amp;originWidth=1730&amp;size=216539&amp;status=done&amp;style=none&amp;width=637&#34; alt=&#34;image.png&#34;&gt;&lt;br&gt;在微服务分布式情况下，不同于以前的单体项目校园中铺项目，是将用户上传的图片放置在单体项目所在服务器的某个文件夹下，单体应用也在这个文件夹，然后单体应用就可以直接访问。但是在分布式情况下，一个服务可能有很多实例部署在多台服务器上，如果仍然使用向单体项目一样的图片存储，则会导致该服务的其他实例的服务器上没有该用户上传的图片，所以为了解决这个问题，分布式中通过使用将用户的图片同一放置在一个位置，然后每个服务都来访问这个位置来存取图片就可以了，这里使用阿里云的对象存储 OSS。&lt;/p&gt;",
            "author": { "@type": "Person", "name": "一止长渊" },
            "@type": "BlogPosting",
            "url": "https://yizhichangyuan.github.io/2021/uncategorized/yuque/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/index.html",
            "publisher": {
            "@type": "Organization",
            "logo": {
                "@type": "ImageObject",
                "url": "https://yizhichangyuan.github.io/images/self-photo.jpeg"
            },
            "name": "一止长渊"
            },
            "headline": "分布式下文件上传 | 一止长渊的博客",
            "datePublished": "2021-03-26T14:58:05.000Z",
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://yizhichangyuan.github.io/2021/uncategorized/yuque/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/index.html"
            },
            "@context": "http://schema.org"
        }
    </script>




    
    <meta name="google-site-verification" content="yizhichangyuan" />
    

    
    <meta property="algolia:search" data-application-id="HJSTQHS8PQ" data-api-key="1af8dce1713110d779f0514c752bf31c" data-index-name="blog">
    

    

    

    

    
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    

    

    
<link rel="stylesheet" href="/dist/build.css?v=1646451311888.css">


    
<link rel="stylesheet" href="/dist/custom.css?v=1646451311888.css">


    <script>
        window.isPost = true
        window.aomori = {
            
            gitalk: {
                enable: true,
                clientID: "",
                clientSecret: "",
                repo: "blog-comments",
                owner: "yizhichangyuan",
                admin: ["yizhichangyuan",],
                distractionFreeMode: true  // Facebook-like distraction free mode
            },
            
            
            
        }
        window.aomori_logo_typed_animated = true
        window.aomori_search_algolia = true

    </script>

<meta name="generator" content="Hexo 5.3.0"></head>

<body>

    <div class="container">
    <header class="header">
        <div class="header-type">
            
            <div class="header-type-avatar avatar avatar-sm">
                <img src="/images/self-photo.jpeg" alt="一止长渊">
            </div>
            
            <div class="header-type-inner">
                
                    <div id="typed-strings" style="display:none">
                        <p>一止长渊的博客</p>
                    </div>
                    <a class="header-type-title" id="typed" href="/"></a>
                
    
                
            </div>
        </div>
        <div class="header-menu">
            <div class="header-menu-inner">
                
                <a href="/">首页</a>
                
                <a href="/archives">存档</a>
                
                <a href="/photography">摄影</a>
                
            </div>
            <div class="header-menu-social">
                
    <a class="social" target="_blank" href="https://github.com/yizhichangyuan">
        <box-icon type='logo' name='github'></box-icon>
    </a>

    <a class="social" target="_blank" href="https://weibo.com/5827404079/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1">
        <box-icon type='logo' name='instagram'></box-icon>
    </a>

    <a class="social" target="_blank" href="https://unsplash.com/@yizhichangyuan">
        <box-icon type='logo' name='unsplash'></box-icon>
    </a>

            </div>
        </div>

        <div class="header-menu-mobile">
            <div class="header-menu-mobile-inner" id="mobile-menu-open">
                <i class="icon icon-menu"></i>
            </div>
        </div>
    </header>

    <div class="header-menu-mobile-menu">
        <div class="header-menu-mobile-menu-bg"></div>
        <div class="header-menu-mobile-menu-wrap">
            <div class="header-menu-mobile-menu-inner">
                <div class="header-menu-mobile-menu-close" id="mobile-menu-close">
                    <i class="icon icon-cross"></i>
                </div>
                <div class="header-menu-mobile-menu-list">
                    
                    <a href="/">首页</a>
                    
                    <a href="/archives">存档</a>
                    
                    <a href="/photography">摄影</a>
                    
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="container">
        <div class="main">
            <section class="inner">
                <section class="inner-main">
                    <div class="post">
    <article id="post-cl2emmv08002yc7obc40sbovc" class="article article-type-post" itemscope
    itemprop="blogPost">

    <div class="article-inner">

        
          
        
        
        

        
        <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      分布式下文件上传
    </h1>
  

        </header>
        

        <div class="article-more-info article-more-info-post hairline">

            <div class="article-date">
  <time datetime="2021-03-26T14:58:05.000Z" itemprop="datePublished">2021-03-26</time>
</div>

            

            

            
            <div class="article-busuanzi">
                <span id="busuanzi_value_page_pv">N</span> 人看过
            </div>
            
                
            <div class="article-busuanzi">
                <span>字数：3.5k字 | 预计阅读时长：16分钟</span>
            </div>
        </div>

        <div class="article-entry post-inner-html hairline" itemprop="articleBody">
            <p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616770699701-f9790556-8ff5-431d-bf42-0727c09fd9c7.png#align=left&display=inline&height=305&margin=%5Bobject%20Object%5D&name=image.png&originHeight=828&originWidth=1730&size=216539&status=done&style=none&width=637" alt="image.png"><br>在微服务分布式情况下，不同于以前的单体项目校园中铺项目，是将用户上传的图片放置在单体项目所在服务器的某个文件夹下，单体应用也在这个文件夹，然后单体应用就可以直接访问。但是在分布式情况下，一个服务可能有很多实例部署在多台服务器上，如果仍然使用向单体项目一样的图片存储，则会导致该服务的其他实例的服务器上没有该用户上传的图片，所以为了解决这个问题，分布式中通过使用将用户的图片同一放置在一个位置，然后每个服务都来访问这个位置来存取图片就可以了，这里使用阿里云的对象存储 OSS。</p>
<a id="more"></a>

<p>阿里 OSS 中这么几个概念：</p>
<ul>
<li>Bucket 就是容器，一般一个微服务对应一个容器即可，存放该微服务所需的照片</li>
<li>对象：就是用户上传的图片或者文件</li>
<li>地域：存储地理位置</li>
<li>访问域名：就是微服务拿取某一张照片，该照片的 URL 地址，例如图中标注</li>
<li>访问密匙：用在身份验证，保证只有拥有密匙才可以向该容器中写入文件，读取的话可以设置公共读不需要验证密匙</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616771101596-d72705ed-4311-4a36-8788-68c60a393a95.png#align=left&display=inline&height=383&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1232&originWidth=1608&size=268079&status=done&style=none&width=500" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616774551139-d663a130-1e84-43ab-9457-29e61bb539f8.png#align=left&display=inline&height=280&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2000.01.22.png&originHeight=1882&originWidth=3358&size=1136906&status=done&style=none&width=500" alt="截屏2021-03-27 00.01.22.png"><br>因为文件上传是写入，所以需要使用到 AccessKey，文件上传也有两种方式：</p>
<ul>
<li>用户上传图片到我们的应用服务器（也就是微服务端），然后微服务端添加上 AccessKey 再通过流的形式发给 OSS</li>
</ul>
<p>缺点：用户上传图片需要经过应用服务器，只是为了添加一项 AccessKey，这是十分没有必要的。而且在多用户的情况下，这里会成为瓶颈</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616774678013-ff7d7745-2405-42e7-b8c1-19a56ffd9bc6.png#align=left&display=inline&height=239&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2000.04.31.png&originHeight=780&originWidth=1632&size=347674&status=done&style=none&width=500" alt="截屏2021-03-27 00.04.31.png"></p>
<ul>
<li>用户直接在客户端上传图片到 OSS 中，在上传之前向应用服务器请求 Policy 上传策略，这里的上传策略就是服务器根据阿里云的 AccessKey 生成一个签名，签名中包含授权令牌以及上传到阿里云的哪个位置等信息，前端拿到这些授权信息后（这些信息并没有账号密码），而是利用账号密码生成的防伪签名，前端戴着防伪签名和上传的文件直接发送到阿里云 OSS，阿里云对防伪签名验证才接受该文件</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616774863664-75147c8c-0bca-4bfb-90ee-894136d3b8df.png#align=left&display=inline&height=267&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2000.07.41.png&originHeight=856&originWidth=1602&size=481664&status=done&style=none&width=500" alt="截屏2021-03-27 00.07.41.png"></p>
<p>开通阿里云存储 =&gt; 创建角色 =&gt; 分配权限 =&gt; 引入依赖 =&gt; 测试<br>创建角色目的：一个微服务可能有相应的运维人员，不能给运维人员所有的权限，所以通过创建角色赋予相应权限的方式来保证安全</p>
<h3 id="一、浏览器通过文件上传到服务器，服务器再加上-accessKey-和-accessSecret-上传"><a href="#一、浏览器通过文件上传到服务器，服务器再加上-accessKey-和-accessSecret-上传" class="headerlink" title="一、浏览器通过文件上传到服务器，服务器再加上 accessKey 和 accessSecret 上传"></a>一、浏览器通过文件上传到服务器，服务器再加上 accessKey 和 accessSecret 上传</h3><ol>
<li><strong>创建角色，分配权限</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616830576660-06c72d0f-fecc-4f8b-9e36-2794d8ef9c4c.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2012.52.35.png&originHeight=2100&originWidth=3360&size=670319&status=done&style=none&width=500" alt="截屏2021-03-27 12.52.35.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616830590822-2a439094-f0de-4847-9bd6-aafc6ff3867d.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2012.55.31.png&originHeight=2100&originWidth=3360&size=430772&status=done&style=none&width=500" alt="截屏2021-03-27 12.55.31.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616830634012-aaf4d53f-74c8-4a5d-95e0-ec7c718608d1.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2012.58.58.png&originHeight=2100&originWidth=3360&size=469950&status=done&style=none&width=500" alt="截屏2021-03-27 12.58.58.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616830643112-b3ae9c90-0b18-47f2-a017-471fd27ea0bd.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2013.00.02.png&originHeight=2100&originWidth=3360&size=662167&status=done&style=none&width=500" alt="截屏2021-03-27 13.00.02.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616830652138-e1d7c9f0-93d4-497d-8557-e8b96e44a7b1.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2013.00.27.png&originHeight=2100&originWidth=3360&size=458718&status=done&style=none&width=500" alt="截屏2021-03-27 13.00.27.png"></p>
<ol start="2">
<li><strong>引入依赖</strong></li>
</ol>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alicloud-oss&lt;/artifactId&gt;
            &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<ol start="3">
<li>application.yml 配置 accessKey</li>
</ol>
<pre><code class="yaml">spring:
  cloud:
    alicloud:
      access-key: xxxxxx # oss文件上传key
      secret-key: xxxxxxx # oss文件上传密匙
      oss:
        endpoint: oss-cn-beijing.aliyuncs.com # bucket名，oss文件上传到哪个容器
</code></pre>
<p>key 和密匙在阿里云 oss 分配的角色中可以看见<br><strong><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616831413303-f69333d0-dc22-41f7-876a-fb6959c6893c.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2012.57.10.png&originHeight=2100&originWidth=3360&size=470456&status=done&style=none&width=500" alt="截屏2021-03-27 12.57.10.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616831640273-7e3b7c5f-9196-4312-b05d-fe7a231de613.png#align=left&display=inline&height=300&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2012.50.30%E7%9A%84%E5%89%AF%E6%9C%AC.png&originHeight=2018&originWidth=3360&size=571789&status=done&style=none&width=500" alt="截屏2021-03-27 12.50.30的副本.png"></strong></p>
<ol start="4">
<li><strong>代码上传</strong></li>
</ol>
<pre><code class="java">    @Resource //这里使用@Resource而不是@Autowired，虽然@Autowired也成功了但是爆红
    private OSSClient ossClient;

    @Test
    public void testUpload() throws FileNotFoundException &#123;
//        // yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。
//        String endpoint = &quot;oss-cn-beijing.aliyuncs.com&quot;;
//        // 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。
//        String accessKeyId = &quot;xxxx&quot;;
//        String accessKeySecret = &quot;xxxx&quot;;
//
//        // 创建OSSClient实例。
//        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);
//
        // 填写本地文件的完整路径。如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。
        InputStream inputStream = new FileInputStream(&quot;/Users/yizhichangyuan/Downloads/60404dae27434.jpg&quot;);
        // 填写Bucket名称和Object完整路径。Object完整路径中不能包含Bucket名称。
        ossClient.putObject(&quot;doermail-product&quot;, &quot;00745YaMgy1gnbcq5f9amj30ta1a8qa1.jpg&quot;, inputStream);

        // 关闭OSSClient
        ossClient.shutdown();
        System.out.println(&quot;上传成功&quot;);
    &#125;
</code></pre>
<p>上传成功<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616831726537-17d47a15-6993-48f9-b6c8-87cea91b5816.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2015.55.21.png&originHeight=2100&originWidth=3360&size=1592081&status=done&style=none&width=500" alt="截屏2021-03-27 15.55.21.png"></p>
<h3 id="二、浏览器经服务端签名后直传-OSS"><a href="#二、浏览器经服务端签名后直传-OSS" class="headerlink" title="二、浏览器经服务端签名后直传 OSS"></a>二、浏览器经服务端签名后直传 OSS</h3><p>由于我们很多微服务都需要上传图片，以往我们在 common 模块采用工具类子模块继承的方式虽然可以避免多次覆写，但是存在着对业务入侵，所以这里我们直接新建一个模块专门处理所有微服务模块所需要的公共服务，例如对浏览器上传图片到 OSS 进行签名。<br>选中 Spring Initalizer =&gt; 选中 web 依赖和 OpenFeign 依赖 =&gt; 继承 common 模块依赖（主要是为了继承其中服务注册发现依赖）<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616832682188-160c5a6d-46fd-4f14-8a63-eac7e201eaca.png#align=left&display=inline&height=332&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2016.10.05.png&originHeight=1178&originWidth=2482&size=289436&status=done&style=none&width=700" alt="截屏2021-03-27 16.10.05.png"></p>
<ol>
<li><strong>添加依赖</strong></li>
</ol>
<pre><code class="xml">   &lt;!--注意其中的spring-cloud版本需要指定为Greenwich.SR3，否则相互依赖会有问题--&gt;
        &lt;spring-cloud.version&gt;Greenwich.SR3&lt;/spring-cloud.version&gt;



        &lt;!--阿里OSS对象存储依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alicloud-oss&lt;/artifactId&gt;
            &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<p>如果添加依赖后爆红，请在 MAVEN 配置文件中添加上阿里云的镜像地址即可解决<br>**</p>
<ol start="2">
<li><strong>该服务注册到 nacos</strong></li>
</ol>
<p>本地新建 bootstrap.properties 文件，添加 nacos 配置中心地址</p>
<pre><code>spring.cloud.nacos.config.server-addr=127.0.0.1:8848
spring.cloud.nacos.config.namespace=c87021e5-fc07-4112-afa6-78871153cc65
spring.cloud.nacos.config.ext-config[0].data-id=oss.yml //读取nacos中的动态文件上传配置
spring.cloud.nacos.config.ext-config[0].group=DEFAULT_GROUP
spring.cloud.nacos.config.ext-config[0].refresh=true
</code></pre>
<p>本地新建 application.yml，添加 nacos 服务注册发现地址</p>
<pre><code class="yaml"># 配置nacos服务注册地址
spring:
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848

  application:
    name: doermail-third-party

server:
  port: 30000
</code></pre>
<p>启动类添加上@EnableDiscoveryClient 注解，开启服务发现注册</p>
<ol start="3">
<li><strong>使用 nacos 配置上传文件的配置 oss.yml</strong></li>
</ol>
<pre><code class="yaml">spring:
  cloud:
    alicloud:
      access-key: xxxxx # 上传者id
      secret-key: xxxxx # 对应密匙
      oss:
        endpoint: oss-cn-beijing.aliyuncs.com # 上传域名
        bucket: doermail-product # 上传文件到哪个容器中
</code></pre>
<p>**<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616858563455-b9614e41-69b3-4349-b857-86c05896efe2.png#align=left&display=inline&height=235&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2023.22.35.png&originHeight=1164&originWidth=2972&size=173162&status=done&style=none&width=600" alt="截屏2021-03-27 23.22.35.png"></p>
<ol start="4">
<li><strong>后端编写签名代码</strong></li>
</ol>
<pre><code class="java">/**
 * @PackageName:com.lookstarry.doermail.thirdparty.controller
 * @NAME:OSSController
 * @Description:
 * @author: yizhichangyuan
 * @date:2021/3/27 20:23
 */
@RefreshScope // 运行期间自动刷新nacos配置，如果有变化的话
@RestController
@RequestMapping(value=&quot;/oss&quot;)
public class OSSController &#123;

    // 注入nacos动态配置中的内容
    @Value(&quot;$&#123;spring.cloud.alicloud.access-key&#125;&quot;)
    private String accessId;

    @Value(&quot;$&#123;spring.cloud.alicloud.secret-key&#125;&quot;)
    private String accessKey;

    @Value(&quot;$&#123;spring.cloud.alicloud.oss.endpoint&#125;&quot;)
    private String endpoint;

    @Value(&quot;$&#123;spring.cloud.alicloud.oss.bucket&#125;&quot;)
    private String bucket;

    @Autowired
    private OSS ossClient;
//
//    @Bean
//    public OSS getOSS()&#123;
//        // 创建OSSClient实例。
//        OSS ossClient = new OSSClientBuilder().build(endpoint, accessId, accessKey);
//        return ossClient;
//    &#125;

    @RequestMapping(value=&quot;/policy&quot;)
    public R policy() &#123;
        // 上传地址：https://doermail-product.oss-cn-beijing.aliyuncs.com/
        String host = &quot;https://&quot; + bucket + &quot;.&quot; + endpoint; // host的格式为 bucketname.endpoint
        // callbackUrl为 上传回调服务器的URL，请将下面的IP和Port配置为您自己的真实信息。
        // String callbackUrl = &quot;http://88.88.88.88:8888&quot;;

        // 文件存储到OSS容器中对应当天日期的文件夹下
        String format = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).format(new Date());
        String dir = format + &quot;/&quot;; // 用户上传文件时指定的前缀。

        Map&lt;String, String&gt; respMap = new LinkedHashMap&lt;String, String&gt;();
        try &#123;
            long expireTime = 30;
            long expireEndTime = System.currentTimeMillis() + expireTime * 1000;
            Date expiration = new Date(expireEndTime);
            // PostObject请求最大可支持的文件大小为5 GB，即CONTENT_LENGTH_RANGE为5*1024*1024*1024。
            PolicyConditions policyConds = new PolicyConditions();
            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, 0, 1048576000);
            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);

            String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);
            byte[] binaryData = postPolicy.getBytes(&quot;utf-8&quot;);
            String encodedPolicy = BinaryUtil.toBase64String(binaryData);
            String postSignature = ossClient.calculatePostSignature(postPolicy);

            respMap.put(&quot;accessid&quot;, accessId);
            respMap.put(&quot;policy&quot;, encodedPolicy);
            respMap.put(&quot;signature&quot;, postSignature); // 上传签名
            respMap.put(&quot;dir&quot;, dir);
            respMap.put(&quot;host&quot;, host);
            respMap.put(&quot;expire&quot;, String.valueOf(expireEndTime / 1000));
        &#125; catch (Exception e) &#123;
            // Assert.fail(e.getMessage());
            System.out.println(e.getMessage());
        &#125; finally &#123;
            ossClient.shutdown();
        &#125;
        return R.ok().put(&quot;data&quot;, respMap);
    &#125;
&#125;
</code></pre>
<ol start="5">
<li>前端在调用文件上传后，会引起跨域文件，因为上传文件 URL 与地址栏 URL 不一致，在 OSS 中修改，添加头部信息允许跨域</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616860392084-0747948d-b956-4b99-8e00-0fcccbde69dd.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2021.52.39.png&originHeight=2100&originWidth=3360&size=511555&status=done&style=none&width=500" alt="截屏2021-03-27 21.52.39.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616860357488-58d29425-1e8a-4530-a8f8-53bb2cb11c38.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2023.01.52.png&originHeight=2100&originWidth=3360&size=581511&status=done&style=none&width=500" alt="截屏2021-03-27 23.01.52.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616860373909-43f8686d-b753-43b1-983a-da55b6245a42.png#align=left&display=inline&height=313&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2023.03.17.png&originHeight=2100&originWidth=3360&size=540377&status=done&style=none&width=500" alt="截屏2021-03-27 23.03.17.png"></p>
<ol start="6">
<li>前端在添加用户文件后，在上传到 OSS 前，会先向后端服务请求签名地址，然后同用户上传的文件一同上传给阿里云 OSS</li>
</ol>
<ul>
<li>前端上传文件前向后端请求签名</li>
</ul>
<pre><code class="vue">import http from &#39;@/utils/httpRequest.js&#39; export function policy() &#123; return new
Promise((resolve,reject)=&gt;&#123; http(&#123; url: http.adornUrl(&quot;/thirdparty/oss/policy&quot;),
method: &quot;get&quot;, params: http.adornParams(&#123;&#125;) &#125;).then((&#123; data &#125;) =&gt; &#123;
resolve(data); &#125;) &#125;); &#125;
</code></pre>
<ul>
<li>文件上传</li>
</ul>
<p>这里使用饿了么的 elementUI 中的 upload 上传功能，此为自动上传，即用户添加文件后自动上传</p>
<pre><code class="vue">&lt;template&gt;
   
  &lt;div&gt;
    &lt;el-upload
      action=&quot;http://doermail-product.oss-cn-beijing.aliyuncs.com&quot;
      :data=&quot;dataObj&quot;
      list-type=&quot;picture&quot;
      :multiple=&quot;false&quot;
      :show-file-list=&quot;showFileList&quot;
      :file-list=&quot;fileList&quot;
      :before-upload=&quot;beforeUpload&quot;
      :on-remove=&quot;handleRemove&quot;
      :on-success=&quot;handleUploadSuccess&quot;
      :on-preview=&quot;handlePreview&quot;
    &gt;
      &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;点击上传&lt;/el-button&gt;
      &lt;div slot=&quot;tip&quot; class=&quot;el-upload__tip&quot;&gt;
        只能上传jpg/png文件，且不超过10MB
      &lt;/div&gt;
    &lt;/el-upload&gt;
    &lt;el-dialog :visible.sync=&quot;dialogVisible&quot;&gt;
      &lt;img width=&quot;100%&quot; :src=&quot;fileList[0].url&quot; alt=&quot;&quot; /&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import &#123; policy &#125; from &quot;./policy&quot;; // 上传前请求后台签名
import &#123; getUUID &#125; from &quot;@/utils&quot;; // 这里的含义表示相对src文件夹，因为utils文件夹有很多类，这里使用解构符号&#123;&#125;只取出getUUID方法

export default &#123;
  name: &quot;singleUpload&quot;, //导出模块名
  props: &#123;
    value: String,
  &#125;,
  computed: &#123;
    imageUrl() &#123;
      return this.value;
    &#125;,
    imageName() &#123;
      if (this.value != null &amp;&amp; this.value !== &quot;&quot;) &#123;
        return this.value.substr(this.value.lastIndexOf(&quot;/&quot;) + 1);
      &#125; else &#123;
        return null;
      &#125;
    &#125;,
    fileList() &#123;
      return [
        &#123;
          name: this.imageName,
          url: this.imageUrl,
        &#125;,
      ];
    &#125;,
    showFileList: &#123;
      get: function () &#123;
        return (
          this.value !== null &amp;&amp; this.value !== &quot;&quot; &amp;&amp; this.value !== undefined
        );
      &#125;,
      set: function (newValue) &#123;&#125;,
    &#125;,
  &#125;,
  data() &#123;
    return &#123;
      dataObj: &#123;
        policy: &quot;&quot;,
        signature: &quot;&quot;,
        key: &quot;&quot;,
        ossaccessKeyId: &quot;&quot;,
        dir: &quot;&quot;,
        host: &quot;&quot;,
        // callback:&#39;&#39;,
      &#125;,
      dialogVisible: false,
    &#125;;
  &#125;,
  methods: &#123;
    emitInput(val) &#123;
      // 选用input，向父组件传入输入的值，在父组件直接可以通过v-model绑定子组件传来的文件上传地址url
      this.$emit(&quot;input&quot;, val);
    &#125;,
    handleRemove(file, fileList) &#123;
      this.emitInput(&quot;&quot;);
    &#125;,
    handlePreview(file) &#123;
      this.dialogVisible = true;
    &#125;,
    // 钩子函数，在上传文件前自动调用该方法请求后端服务器上传文件签名
    // 并封装在dataObj，在&lt;el-upload&gt;使用:data=&quot;dataObj&quot;绑定参数，文件上传时同文件一起上传给指定的action=&quot;http://doermail-product.oss-cn-beijing.aliyuncs.com&quot;
    beforeUpload(file) &#123;
      let _self = this;
      return new Promise((resolve, reject) =&gt; &#123;
        policy()
          .then((response) =&gt; &#123;
            _self.dataObj.policy = response.data.policy;
            _self.dataObj.signature = response.data.signature;
            _self.dataObj.ossaccessKeyId = response.data.accessid;
            _self.dataObj.key =
              response.data.dir + getUUID() + &quot;/&quot; + &quot;$&#123;filename&#125;&quot;; // 防止文件上传oss后重名就被覆盖，这里使用UUID随机创建一个文件夹后再保存
            _self.dataObj.dir = response.data.dir;
            _self.dataObj.host = response.data.host;
            resolve(true);
          &#125;)
          .catch((err) =&gt; &#123;
            reject(false);
          &#125;);
      &#125;);
    &#125;,
    // 文件上传成功后的钩子函数
    handleUploadSuccess(res, file) &#123;
      console.log(&quot;上传成功...&quot;);
      this.showFileList = true;
      this.fileList.pop();
      this.fileList.push(&#123;
        name: file.name,
        url:
          this.dataObj.host +
          &quot;/&quot; +
          this.dataObj.key.replace(&quot;$&#123;filename&#125;&quot;, file.name),
      &#125;);
      // 向父组件传入文件地址url，便于后续入库地址
      this.emitInput(this.fileList[0].url);
    &#125;,
  &#125;,
&#125;;
&lt;/script&gt;
&lt;style&gt;&lt;/style&gt;
</code></pre>
<ul>
<li>表单中使用 SingleUpload 组件</li>
</ul>
<p>这里直接使用<single-upload>或<single-upload>来 使用前面编写好的组件，这里使用了 v-model 直接上传后文件地址绑定到了 dataForm 对象中 logo 属性便于向后端插入一条数据库记录</single-upload></single-upload></p>
<pre><code class="vue">&lt;template&gt;
  &lt;el-dialog
    :title=&quot;!dataForm.id ? &#39;新增&#39; : &#39;修改&#39;&quot;
    :close-on-click-modal=&quot;false&quot;
    :visible.sync=&quot;visible&quot;
  &gt;
    &lt;el-form
      :model=&quot;dataForm&quot;
      :rules=&quot;dataRule&quot;
      ref=&quot;dataForm&quot;
      @keyup.enter.native=&quot;dataFormSubmit()&quot;
      label-width=&quot;140px&quot;
    &gt;
      &lt;el-form-item label=&quot;品牌名&quot; prop=&quot;name&quot;&gt;
        &lt;el-input v-model=&quot;dataForm.name&quot; placeholder=&quot;品牌名&quot;&gt;&lt;/el-input&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;品牌logo地址&quot; prop=&quot;logo&quot;&gt;
        &lt;!-- &lt;el-input v-model=&quot;dataForm.logo&quot; placeholder=&quot;品牌logo地址&quot;&gt;&lt;/el-input&gt; --&gt;
        &lt;!--这里直接使用&lt;single-upload&gt;或&lt;single-upload&gt;来 使用前面编写好的组件
                    这里使用了v-model直接上传后文件地址绑定到了dataForm对象中logo属性便于向后端插入一条数据库记录--&gt;
        &lt;single-upload v-model=&quot;dataForm.logo&quot;&gt;&lt;/single-upload&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;介绍&quot; prop=&quot;descript&quot;&gt;
        &lt;el-input v-model=&quot;dataForm.descript&quot; placeholder=&quot;介绍&quot;&gt;&lt;/el-input&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;显示状态&quot; prop=&quot;showStatus&quot;&gt;
        &lt;el-switch
          v-model=&quot;dataForm.showStatus&quot;
          active-color=&quot;#13ce66&quot;
          inactive-color=&quot;#ff4949&quot;
        &gt;
        &lt;/el-switch&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;检索首字母&quot; prop=&quot;firstLetter&quot;&gt;
        &lt;el-input
          v-model=&quot;dataForm.firstLetter&quot;
          placeholder=&quot;检索首字母&quot;
        &gt;&lt;/el-input&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label=&quot;排序&quot; prop=&quot;sort&quot;&gt;
        &lt;el-input v-model=&quot;dataForm.sort&quot; placeholder=&quot;排序&quot;&gt;&lt;/el-input&gt;
      &lt;/el-form-item&gt;
    &lt;/el-form&gt;
    &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;
      &lt;el-button @click=&quot;visible = false&quot;&gt;取消&lt;/el-button&gt;
      &lt;el-button type=&quot;primary&quot; @click=&quot;dataFormSubmit()&quot;&gt;确定&lt;/el-button&gt;
    &lt;/span&gt;
  &lt;/el-dialog&gt;
&lt;/template&gt;

&lt;script&gt;
import SingleUpload from &quot;@/components/upload/singleUpload&quot;
export default &#123;
  components: &#123;SingleUpload&#125;,
    data() &#123;
    return &#123;
      visible: false,
      dataForm: &#123;
        brandId: 0,
        name: &quot;&quot;,
        logo: &quot;&quot;,
        descript: &quot;&quot;,
        showStatus: &quot;&quot;,
        firstLetter: &quot;&quot;,
        sort: &quot;&quot;,
      &#125;
    &#125;;
    &#125;
    methods: ...
  &#125;
</code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2648023/1616860182182-6cefa878-3f7a-4a01-834c-ed778da46213.png#align=left&display=inline&height=375&margin=%5Bobject%20Object%5D&name=%E6%88%AA%E5%B1%8F2021-03-27%2023.14.43.png&originHeight=2100&originWidth=3360&size=737871&status=done&style=none&width=600" alt="截屏2021-03-27 23.14.43.png"></p>

        </div>

    </div>

    

    

    

    
  <div class="article-copyright hairline">
    <p>
      本作品采用  <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议 (CC BY-NC-ND 4.0)</a> 进行许可。
    </p>
  </div>
  

    

    
<nav class="article-nav">
  
    <a href="/2021/uncategorized/yuque/%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-caption">下一篇</div>
      <div class="article-nav-title">
        
          后端数据校验
        
      </div>
    </a>
  
  
    <a href="/2021/uncategorized/yuque/JS%E8%84%9A%E6%9C%AC%E8%AF%B7%E6%B1%82%E8%B7%A8%E5%9F%9F/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-caption">上一篇</div>
      <div class="article-nav-title">JS脚本请求跨域</div>
    </a>
  
</nav>


    <section class="share">
        <div class="share-title">分享</div>
        <a class="share-item" target="_blank"
            href="https://twitter.com/share?text=分布式下文件上传 - 一止长渊的博客&url=https://yizhichangyuan.github.io/2021/uncategorized/yuque/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">
            <box-icon type='logo' name='twitter'></box-icon>
        </a>
        <a class="share-item" target="_blank"
            href="https://www.facebook.com/sharer.php?title=分布式下文件上传 - 一止长渊的博客&u=https://yizhichangyuan.github.io/2021/uncategorized/yuque/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">
            <box-icon name='facebook-square' type='logo' ></box-icon>
        </a>
        <!-- <a class="share-item" target="_blank"
            href="https://service.weibo.com/share/share.php?title=分布式下文件上传 - 一止长渊的博客&url=https://yizhichangyuan.github.io/2021/uncategorized/yuque/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/&pic=">
            <div class="n-icon n-icon-weibo"></div>
        </a> -->
    </section>

</article>








<section class="comments">
    <div id="gitalk-container"></div>
</section>









<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</div>
                </section>
            </section>

            
            <aside class="sidebar sidebar-search-fix">
                

    <div class="search">
    <div class="has-icon-right">
        <input type="text" class="form-input" id="search" placeholder="SEARCH" autocomplete="off">
        <div class="form-icon">
            <box-icon name='search' color="#3c4859"></box-icon>
        </div>
    </div>
    <div class="search-result" id="search-ps"></div>
</div>


<div class="widget" id="widget">
    
      
  <div class="widget-wrap">
    <div class="widget-inner">
      <div class="toc post-toc-html"></div>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-cate">
    <div class="widget-title"><span>Categories</span></div>
    <div class="widget-inner">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E4%B8%9C%E6%88%98%E4%BA%89%E5%8F%B2/">中东战争史</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/">线程安全</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-tags">
    <div class="widget-title"><span>Tags</span></div>
    <div class="widget-inner">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kaptcha/" rel="tag">Kaptcha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MYSQL%E9%9B%86%E7%BE%A4/" rel="tag">MYSQL集群</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nacos/" rel="tag">Nacos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zxing/" rel="tag">Zxing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%86%E5%8F%B2/" rel="tag">历史</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">微服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C/" rel="tag">数据校验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%AD%E9%93%BE/" rel="tag">短链</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B/" rel="tag">线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7/" rel="tag">缓存一致性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-recent-posts">
    <div class="widget-title"><span>Recent Posts</span></div>
    <div class="widget-inner">
      <ul>
        
          <li>
            <a href="/2021/uncategorized/yuque/ThreadPoolExecutor/">ThreadPoolExecutor</a>
          </li>
        
          <li>
            <a href="/2021/uncategorized/yuque/%E4%B8%AD%E6%96%AD/">中断</a>
          </li>
        
          <li>
            <a href="/2021/uncategorized/yuque/ConcurrentHashMap%E5%8E%9F%E7%90%86%E5%88%9D%E6%8E%A2/">ConcurrentHashMap原理初探</a>
          </li>
        
          <li>
            <a href="/2021/uncategorized/yuque/%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%90%8C%E6%97%B6%E6%9C%89%E4%B8%A4%E4%B8%AA%E5%90%8C%E7%B1%BB%E5%9E%8BBean%E5%AD%98%E5%9C%A8/">容器中同时有两个同类型Bean存在</a>
          </li>
        
          <li>
            <a href="/2021/uncategorized/yuque/%E7%A7%92%E6%9D%80/">秒杀</a>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-archive">
    <div class="widget-title"><span>Archive</span></div>
    <div class="widget-inner">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li></ul>
    </div>
  </div>


    
</div>

<div id="backtop"><i class="icon icon-arrow-up"></i></div>
            </aside>
            
        </div>
    </div>

    <footer class="footer">
    <div class="footer-wave">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3c4859" fill-opacity="1" d="M0,160L60,181.3C120,203,240,245,360,240C480,235,600,181,720,186.7C840,192,960,256,1080,261.3C1200,267,1320,213,1380,186.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>

    <!-- Please do not remove this -->
    <!-- 开源不易，请勿删除 -->
    <div class="footer-wrap">
        <div class="footer-inner"> 
            一止长渊的博客 &copy; 2022<br>
            <!-- 不蒜子统计 -->
            <span id="busuanzi_container_site_pv">
                本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>
            <span class="post-meta-divider">|</span>
            <span id="busuanzi_container_site_uv" style='display:none'>
                    本站访客数<span id="busuanzi_value_site_uv"></span>人
            </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><br>
            Powered By Hexo · Theme By <a href="https://linhong.me/" target="_blank">Aomori</a> · <a href="https://github.com/lh1me/hexo-theme-aomori" target="_blank">Github</a>
        </div>
    </div>

</footer>


<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>





<script src="/dist/build.js?1646451311888.js"></script>


<script src="/dist/custom.js?1646451311888.js"></script>



<!-- 百度链接提交 -->
<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>



<!-- Google Analytics-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX-X"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-XXXXX-X');
</script>









</body>

</html>